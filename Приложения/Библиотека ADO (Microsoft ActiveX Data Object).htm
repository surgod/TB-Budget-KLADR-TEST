<html>
<head>
<meta http-equiv="Content-Language" content="ru">
<meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<title>Библиотека ADO (Microsoft ActiveX Data Object)</title>
<META NAME="keywords" content="Использование, библиотека, ADO, Microsoft, ActiveX, Data, Object">
<META NAME="description" content="Использование библиотеки ADO (Microsoft ActiveX Data Object)">

<STYLE type="text/css"> 
	.paragraph {text-align:justify; text-indent:2em; margin-top:0; margin-bottom:0}
</style>

</head>
<body bgcolor=#E0E0E0>

<p><a href="index.html">Перейти на главную страничку сайта (список статей, файлы для скачивания)</a></p>
<p><a href="http://forum.script-coding.com">ФОРУМ (здесь можно обсудить эту статью, а также любые
проблемы программирования на различных макроязыках и в скриптовых средах)</a></p>

<h1>Использование библиотеки ADO (Microsoft ActiveX Data Object)</h1>

<h2 style="text-indent:1.3em">Понятие о библиотеке ADO</h2>

<p class="paragraph">
Библиотека ADO (Microsoft ActiveX Data Object) служит для доступа к базам данных различных типов и предоставляет
объектный программный интерфейс к интерфейсу OLE DB, который предлагается компанией Microsoft как альтернатива
интерфейсу ODBC. Объектная модель ADO реализована на базе технологии COM (Component Object Model).
</p>

<p class="paragraph">
Библиотека ADO может быть использована в любых средах, которые в состоянии выступить в роли OLE-клиента, например,
в MS Office (VBA), 1C:Предприятии, административных скриптах Windows (.vbs и .js) и т.д. Примеры кода в настоящей
статье будут приводиться на языке VBScript для административных скриптов Windows. С помощью библиотеки ADO можно
обратиться к огромному количеству типов баз данных, например, dBASE, Access, Excel, Oracle, Paradox, MS SQL Server,
Sybase, текстовые файлы, FoxPro, Active Directory Service, Microsoft Jet, Interbase, Informix, PostgreSQL, MySQL
и т.д., необходимо только наличие установленного соответствующего OLE-провайдера ("драйвера" соответствующего типа
базы данных, который устанавливается в систему как правило из дистрибутива этой же базы данных). Примеры кода в
настоящей статье будут приводиться только для MS SQL Server, т.к. невозможно объять необъятное. Перечень свойств
и методов ADO, приведённый в этой статье, не является исчерпывающим (в некоторых случаях и описание некоторых
свойств и методов не является полным). Полное описание объектной модели библиотеки ADO вы можете получить в MSDN
или в файле "ADO210.CHM", который входит в поставку MS Office. Однако материала данной статьи достаточно, чтобы
начать работать с ADO.
</p>

<p class="paragraph">
Основными объектами библиотеки ADO являются объекты <a href="#ConnectionObject">Connection</a>,
<a href="#CommandObject">Command</a> и <a href="#RecordsetObject">Recordset</a>.
</p>

<h2 style="text-indent:1.3em"><a name="ConnectionObject">Объект Connection</a></h2>

<p class="paragraph">
Объект Connection обеспечивает создание подключения к источнику данных и эквивалентен текущему сетевому соединению
с сервером. Объект Connection предоставляет возможность настройки соединения перед его открытием, установки базы
данных по умолчанию, установки и разрыва соединения с источником данных, задания настроек и выполнения команды с
помощью метода Execute. Примечание: для выполнения команды можно использовать также метод Execute объекта
<a href="#CommandObject">Command</a>, не прибегая к объекту Connection.
</p>

<p class="paragraph">
Объект Connection создаётся следующим образом:
<br><br>
<span style="color:navy; font-weight:bold;">
Set objConn = CreateObject("ADODB.Connection")
</span>
<br><br>
После этого вы можете вызывать и использовать методы и свойства этого объекта для доступа к базам данных:
<br><br>
<TABLE border="1" width="100%" cellspacing="0">
<TR><TH></TH><TH>Описание</TH></TR>

<TR>
<TD>Version</TD>
<TD>Содержит строку, определяющую версию библиотеки. Только чтение.</TD>
</TR>

<TR>
<TD>ConnectionString</TD>
<TD>Определяет параметры подключения к источнику данных. Чтение и запись. Это строка, содержащая несколько
параметров, разделённых точкой с запятой. Свойство ConnectionString автоматически получает значение, заданное в
качестве одноимённого аргумента метода Open. Свойство ConnectionString доступно для записи только для закрытого
соединения. Многочисленные примеры различных строк подключения для различных типов баз данных вы можете найти в
Интернете или в документации к соответствующим программным продуктам.</TD>
</TR>

<TR>
<TD>ConnectionTimeout</TD>
<TD>Устанавливает или возвращает число секунд ожидания подключения к базе данных. Значение по умолчанию - 15.
Используйте это свойство, если возникают проблемы из-за плотного сетевого трафика или загруженности сервера.
Если время, указанное в ConnectionTimeout, истекает до открытия подключения, происходит ошибка, и ADO отменяет
попытку подключения. Если Вы установите свойство в ноль, ADO будет ждать бесконечно, пока подключение не будет
открыто. Удостоверьтесь, что используемый провайдер поддерживает свойство ConnectionTimeout. Свойство доступно для
записи только для закрытого соединения.</TD>
</TR>

<TR>
<TD>CommandTimeout</TD>
<TD>Устанавливает или возвращает число секунд ожидания выполнения команды. Значение по умолчанию - 30. Чтение и
запись. Используйте это свойство, если возникают проблемы из-за плотного сетевого трафика или загруженности сервера.
Если время, указанное в CommandTimeout, истекает до завершения выполнения команды, происходит ошибка, и ADO отменяет
команду. Если Вы установите свойство в ноль, ADO будет ждать бесконечно, пока команда не будет выполнена.
Удостоверьтесь, что используемый провайдер поддерживает свойство CommandTimeout. Установка CommandTimeout объекта
Connection никак не связана с установкой свойства CommandTimeout объекта Command.</TD>
</TR>

<TR>
<TD>Provider</TD>
<TD>Устанавливает или возвращает строковое значение, которое содержит имя используемого провайдера. По умолчанию
- "MSDASQL". Провайдер может быть также установлен содержанием свойства ConnectionString или параметром метода Open.
Определение провайдера в более чем одном месте может иметь непредсказуемые результаты.</TD>
</TR>

<TR>
<TD>DefaultDatabase</TD>
<TD>Устанавливает или возвращает строковое значение, которое содержит заданную по умолчанию базу данных. Если есть
заданная по умолчанию база данных, запросы SQL могут использовать "дисквалифицированный" синтаксис для обращения
к объектам в этой базе данных. Чтобы обращаться к объектам из другой базы данных, вы должны "квалифицировать"
имена объектов именем этой базы данных. При подключении провайдер записывает заданную по умолчанию базу данных в
это свойство. Некоторые провайдеры разрешают только одну такую базу данных на одно подключение, и в этом случае вы
не сможете изменить это свойство. Некоторые источники данных и провайдеры могут не поддерживать это свойство,
генерируя ошибку или возвращая пустую строку.</TD>
</TR>

<TR>
<TD>CursorLocation</TD>
<TD>Определяет расположение курсора, т.е. место, где выполняется работа с данными. Возможные значения:
<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>adUseNone(1) - курсор не используется (только для совместимости со старыми версиями).</LI>
<LI>adUseServer(2) - курсор на стороне провайдера (по умолчанию).</LI>
<LI>adUseClient(3) - курсор на стороне пользователя. Может предоставлять дополнительные возможности, которые
отсутствуют на стороне провайдера.</LI>
</UL>
Изменение свойства CursorLocation не имеет никакого эффекта при уже существующем подключении. Связанные объекты
Recordset и курсоры, возвращённые методом Execute, наследуют эту установку. При открытом объекте Recordset это
свойство доступно только для чтения.
</TD>
</TR>

<TR>
<TD>Mode</TD>
<TD>Определяет режим доступа для изменения данных в сеансе. Возможные значения:
<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>adModeUnknown(0) - режим доступа не установлен или не может быть определён (по умолчанию).</LI>
<LI>adModeRead(1) - режим только для чтения.</LI>
<LI>adModeWrite(2) - режим только для записи.</LI>
<LI>adModeReadWrite(3) - режим для чтения и записи.</LI>
<LI>adModeShareDenyRead(4) - не разрешает открывать соединение на чтение другим пользователям.</LI>
<LI>adModeShareDenyWrite(8) - не разрешает открывать соединение на запись другим пользователям.</LI>
<LI>adModeShareExclusive(12) - не разрешает открывать соединение другим пользователям.</LI>
<LI>adModeShareDenyNone(16) - разрешает открывать соединение с любым видом доступа другим пользователям.</LI>
</UL>
Вы можете установить это свойство только тогда, когда объект Connection закрыт.
</TD>
</TR>

<TR>
<TD>Errors</TD>
<TD>Содержит коллекцию объектов Error. Любая инструкция, использующая объекты ADO, может сгенерировать одну или
более ошибок провайдера. Когда происходит ошибка, в эту коллекцию могут быть помещены один или более объектов Error.
Если следующая подобная инструкция также сгенерирует ошибку, коллекция будет очищена и заполнена заново. Каждый
объект Error представляет определённую ошибку провайдера, но не ошибку ADO (ошибки ADO подвергаются механизму
обработки исключительных ситуаций). Используйте метод Clear, чтобы вручную очистить коллекцию Errors. Некоторые
свойства и методы возвращают предупреждения, которые появляются как объекты Error в коллекции Errors, при этом
не останавливая выполнение программы. Перед тем, как вы вызываете методы Resync, UpdateBatch или CancelBatch
объекта Recordset, метод Open объекта Connection, или устанавливаете свойство Filter объекта Recordset, вызовите
метод Clear коллекции Errors. После этого вы можете прочитать свойство Count коллекции Errors, чтобы проверить
возвращенные предупреждения.</TD>
</TR>

<TR>
<TD>State</TD>
<TD>Содержит состояние объекта. Только чтение. Свойство State может принимать следующие значения:
<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>adStateClosed(0) - объект закрыт.</LI>
<LI>adStateOpen(1) - объект открыт.</LI>
<LI>adStateConnecting(2) - объект соединяется.</LI>
<LI>adStateExecuting(4) - объект выполняет команду.</LI>
<LI>adStateFetching(8) - объект выполняет выборку строк.</LI>
</UL>
</TD>
</TR>

<TR>
<TD>Properties</TD>
<TD>Содержит коллекцию динамических свойств соединения (объектов Property). Подробнее - см. раздел "Динамические
свойства объектов".</TD>
</TR>

<TR>
<TD>Open(ConnectionString, UserID, Password, Options)</TD>
<TD>Открывает сеанс подключения к источнику данных. Параметры:
<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>ConnectionString - необязательный. Строка, определяющая параметры подключения к источнику данных. Автоматически
наследует значение свойства ConnectionString объекта Connection. Вы можете или установить свойство ConnectionString
объекта Connection перед вызовом метода Open, или использовать параметр ConnectionString метода Open.</LI>
<LI>UserID - необязательный. Имя пользователя, используемое при соединении.</LI>
<LI>Password - необязательный. Пароль пользователя.</LI>
<LI>Options - необязательный. Способ подключения к источнику данных. Возможные значения:
<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>adAsyncConnect(16) - открывает подключение асинхронно. Чтобы определить, когда подключение станет доступным,
можно обрабатывать событие ConnectComplete.</LI>
<LI>adConnectUnspecified(-1) - по умолчанию. Открывает подключение синхронно.</LI>
</UL>
</LI>
</UL>
Если вы передаете информацию о пользователе и пароле как в строке ConnectionString, так и в параметрах UserID и
Password, параметры UserID и Password имеют приоритет. Закончив ваши операции с открытым подключением, используйте
метод Close() для освобождения всех связанных системных ресурсов.
</TD>
</TR>

<TR>
<TD>Close()</TD>
<TD>Закрывает соединение с источником данных. Закрытие объекта не приводит к удалению его из памяти. Можно изменить
свойства объекта, а затем открыть его снова. При закрытии подключения закрываются также все активные наборы записей
(объекты Recordset) для данного подключения. Объекты Command, связанные с данным подключением, уже не будут связаны
с данным объектом Connection. Закрытие объекта Connection во время транзакции генерирует ошибку и ADO автоматически
откатывает транзакцию.</TD>
</TR>

<TR>
<TD>Execute(CommandText, RecordsAffected, Options)</TD>
<TD>Выполняет запрос, оператор SQL, хранимую процедуру или любую другую команду, доступную провайдеру. Возвращает
объект Recordset, доступный только для чтения курсором Forward-only, если переданная команда возвращает записи.
(Если нужен объект Recordset, доступный для записи, следует создать его непосредственно, и воспользоваться его
свойствами и методами.) Параметры:
<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>CommandText - обязательный. Строка, содержащая оператор SQL, имя таблицы, хранимой процедуры или другую команду
провайдера.</LI>
<LI>RecordsAffected - необязательный. Целое число (long), определяющее число записей, затронутых командой.
Заполняется провайдером.</LI>
<LI>Options - необязательный. Целое число (long), определяющее тип команды. Возможные значения (значения можно
суммировать):
<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>adCmdText(1) - текстовое определение команды или хранимой процедуры.</LI>
<LI>adCmdTable(2) - создать SQL-запрос, который вернёт все строки указанной таблицы.</LI>
<LI>adCmdStoredProc(4) - хранимая процедура.</LI>
<LI>adCmdUnknown(8) - тип команды неизвестен (по умолчанию).</LI>
<LI>adAsyncExecute(16) - асинхронное выполнение команды.</LI>
<LI>adExecuteNoRecords(128) - не возвращать строки.</LI>
</UL>
</LI>
</UL>
</TD>
</TR>

<TR>
<TD>Cancel()</TD>
<TD>Отменяет выполнение последнего асинхронного вызова Execute() или Open(), если действие ещё не завершено.</TD>
</TR>

<TR>
<TD>ConnectComplete(pError, adStatus, pConnection)</TD>
<TD>Событие возникает после того, как осуществлено подключение к источнику данных. Параметры:
<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>pError - содержит объект Error, если произошли ошибки (свойство adStatus равно adStatusErrorsOccurred(2))</LI>
<LI>adStatus - определяет состояние соединения. Возможные значения (для всех событий):
<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>adStatusOK(1) - операция произведена успешно.</LI>
<LI>adStatusErrorsOccurred(2) - операция потерпела неудачу.</LI>
<LI>adStatusCantDeny(3) - операция не может быть отменена.</LI>
<LI>adStatusCancel(4) - произошла отмена операции.</LI>
<LI>adStatusUnwantedEvent(5) - предотвращает последующие уведомления до завершения выполнения метода события.</LI>
</UL>
</LI>
<LI>pConnection - объект Connection, который вызвал событие.</LI>
</UL>
</TD>
</TR>

<TR>
<TD>Disconnect(adStatus, pConnection)</TD>
<TD>Событие возникает после того, как прервано подключение к источнику данных. Параметры аналогичны параметрам
события ConnectComplete.</TD>
</TR>

<TR>
<TD>InfoMessage(pError, adStatus, pConnection)</TD>
<TD>Событие возникает каждый раз, когда генерируется предупреждение (warning). Параметры аналогичны параметрам
события ConnectComplete.</TD>
</TR>

<TR>
<TD>WillConnect(ConnectionString, UserID, Password, Options, adStatus, pConnection)</TD>
<TD>Событие возникает перед тем, как осуществлено подключение к источнику данных. Параметры в основном аналогичны
параметрам события ConnectComplete. Options - целое число (long), которое указывает способ подключения -
adAsyncConnect(16) или adConnectUnspecified(-1). В обработчике события можно изменять параметры подключения.</TD>
</TR>

<TR>
<TD>WillExecute(Source, CursorType, LockType, Options, adStatus, pCommand, pRecordset, pConnection)</TD>
<TD>Событие возникает перед выполнением команды. Параметры:
<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>Source - строка, содержащая оператор SQL или имя хранимой процедуры.</LI>
<LI>CursorType - тип курсора для Recordset, который будет открыт. Тип курсора можно изменять. Возможные
значения:
<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>adOpenUnspecified(-1) - тип курсора не определён.</LI>
<LI>adOpenForwardOnly(0) - определяет forward-only курсор. То же, что и статический курсор, но вы
можете прокручивать записи только вперед. Это оптимизирует выполнение, если вы должны сделать только один проход по
Recordset'у.</LI>
<LI>adOpenKeyset(1) - Определяет keyset-курсор. То же, что и динамический курсор, но вы не можете видеть записи,
добавляемые другими пользователями, хотя записи, удаляемые другими пользователями, недоступны в вашем Recordset'е.
Изменения данных другими пользователями видимы.</LI>
<LI>adOpenDynamic(2) - Определяет динамический курсор. Добавления, изменения и удаления другими пользователями
видимы; разрешены все типы движения через Recordset, исключая закладки, если провайдер их не поддерживает.</LI>
<LI>adOpenStatic(3) - Определяет статический курсор. Статическая копия набора записей, которую вы можете
использовать, чтобы найти данные или генерировать отчёты. Добавления, изменения или удаления другими пользователями
не видимы.</LI>
</UL>
</LI>
<LI>LockType - тип блокировки для Recordset, который будет открыт. Возможные значения:
<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>adLockUnspecified(-1) - тип блокировки не определён.</LI>
<LI>adLockReadOnly(1) - только для чтения. Вы не можете изменить данные.</LI>
<LI>adLockPessimistic(2) - пессимистическая блокировка. Провайдер гарантирует успешное редактирование записей.
Запись блокируется сразу после начала редактирования и до момента сохранения записей.</LI>
<LI>adLockOptimistic(3) - оптимистическая блокировка. Провайдер осуществляет блокировку записей только в момент
сохранения изменений, т.е. когда вы вызываете метод Update().</LI>
<LI>adLockBatchOptimistic(4) - оптимистические пакетные модификации. Требуется для пакетного режима модификации
(отложенное сохранение записей).</LI>
</UL>
</LI>
<LI>Options - целое число (long), указывающее опции выполнения команды или открытия Recordset'а.</LI>
<LI>adStatus - определяет состояние события. Возможные значения - см. описание аналогичного параметра события
ConnectComplete.</LI>
<LI>pCommand - объект Command, для которого применяется это событие.</LI>
<LI>pRecordset - объект Recordset, для которого применяется это событие.</LI>
<LI>pConnection - объект Connection, для которого применяется это событие.</LI>
</UL>
Событие WillExecute может произойти из-за вызовов Connection.Execute, Command.Execute, или Recordset.Open. Параметр
pConnection всегда содержит ссылку на объект Connection. Если событие происходит из-за вызова Connection.Execute,
параметры pRecordset и pCommand будут установлены в Nothing. Если событие происходит из-за вызова Recordset.Open,
параметр pRecordset будет содержать ссылку на объект Recordset, а параметр pCommand будет установлен в Nothing.
Если событие происходит из-за вызова Command.Execute, параметр pCommand будет содержать ссылку на  объект Command,
а параметр pRecordset будет установлен в Nothing.
</TD>
</TR>

<TR>
<TD>ExecuteComplete(RecordsAffected, pError, adStatus, pCommand, pRecordset, pConnection)</TD>
<TD>Событие происходит после завершения работы команды. Параметр RecordsAffected - целое число (long) - содержит
количество записей, которые затрагивает команда. Остальные параметры аналогичны одноимённым параметрам описанных
выше других событий. Событие ExecuteComplete может произойти вследствие вызовов Connection.Execute, Command.Execute,
Recordset.Open, Recordset.Requery или Recordset.NextRecordset.</TD>
</TR>

<TR>
<TD>BeginTrans()<br><br>CommitTrans()<br><br>RollbackTrans()</TD>
<TD>Вызов метода BeginTrans начинает новую транзакцию. Провайдеры, которые поддерживают вложенные транзакции,
при вызове метода BeginTrans в пределах открытой транзакции начинают новую, вложенную транзакцию. Возвращаемое
методом BeginTrans значение указывает уровень вложения: возвращаемое значение "1" указывает, что вы открыли
транзакцию верхнего уровня (то есть транзакция не вложена в пределах другой транзакции), "2" указывает, что вы
открыли транзакцию второго уровня (транзакция, вложенная в пределах транзакции верхнего уровня), и т.д.
<br><br>
Вызов метода CommitTrans сохраняет изменения, сделанные в пределах открытой транзакции и завершает транзакцию. Вызов
метода RollbackTrans полностью отменяет любые изменения, сделанные в пределах открытой транзакции и завершает
транзакцию. Вызов любого из этих методов в момент, когда нет никакой открытой транзакции, генерирует ошибку. Вызовы
методов CommitTrans или RollbackTrans затрагивают только последнюю открытую транзакцию; вы должны закрыть или
откатить текущую транзакцию прежде, чем разрешить любые высокоуровневые транзакции.
</TD>
</TR>

<TR>
<TD>BeginTransComplete(TransactionLevel, pError, adStatus, pConnection)<br><br>
CommitTransComplete(pError, adStatus, pConnection)<br><br>
RollbackTransComplete(pError, adStatus, pConnection)
</TD>
<TD>Эти события вызываются после того, как заканчивает выполняться соответствующая операция (по работе с
транзакциями) на объекте Connection.</TD>
</TR>

<TR>
<TD>OpenSchema(QueryType, Criteria, SchemaID)</TD>
<TD>Получает информацию схемы базы данных от провайдера. Возвращает объект Recordset. Recordset будет открыт как
статический курсор только для чтения. Параметры:
<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>QueryType - число, тип запроса схемы. Подробнее - см. MSDN, описание перечисления "SchemaEnum".</LI>
<LI>Criteria - необязательный. Массив ограничений запроса (фильтр). Подробнее - см. MSDN.</LI>
<LI>SchemaID - GUID для запроса схемы провайдера, не определенной спецификацией. Этот параметр требуется, если
QueryType установлен в adSchemaProviderSpecific(-1); иначе этот параметр не используется.</LI>
</UL>
</TD>
</TR>

</TABLE>
<br>
</p>

<p class="paragraph">
Объект Error содержит информацию об ошибках доступа к данным, которые принадлежат отдельной операции провайдера. Вы
можете обратиться к свойствам объекта Error, чтобы получить информацию о каждой ошибке:
<br><br>
<TABLE border="1" width="100%" cellspacing="0">
<TR><TH></TH><TH>Описание</TH></TR>

<TR>
<TD>Description</TD>
<TD>Содержит строку, определяющую короткое описание ошибки. Это свойство по умолчанию.</TD>
</TR>

<TR>
<TD>Number</TD>
<TD>Содержит уникальный код, определяющий тип ошибки (целое число).</TD>
</TR>

<TR>
<TD>Source</TD>
<TD>Идентифицирует имя объекта, который вызвал ошибку (строка).</TD>
</TR>

<TR>
<TD>SQLState</TD>
<TD>Содержит строку из пяти символов, которая указывает код ошибки по стандарту SQL ANSI.</TD>
</TR>

<TR>
<TD>NativeError</TD>
<TD>Содержит определённый провайдером код ошибки (целое число).</TD>
</TR>

</TABLE>
<br>
</p>

<p class="paragraph">
Подключаемся к базе данных и выполняем запрос с помощью объекта Connection:
<br><br>
<span style="color:navy; font-weight:bold;">
<pre>
Set objConn = CreateObject("ADODB.Connection")
'Определяем параметры подключения к базе данных
ServerName = "(local)" 'имя или IP-адрес сервера
DSN = "master" 'имя базы данных
UID = "sa" 'логин пользователя SQL-сервера
PWD = "111" 'пароль пользователя SQL-сервера
ConnectString = "Provider=SQLOLEDB;" & _
                "Data Source=" & ServerName & _
                ";Initial Catalog=" & DSN & _
                ";UID=" & UID & ";PWD=" & PWD
objConn.ConnectionString = ConnectString
objConn.ConnectionTimeOut = 15
objConn.CommandTimeout = 30
'Подключаемся к базе данных
objConn.Open
'Выполняем запрос
Set objRecordset = objConn.Execute("SELECT name, filename FROM sysdatabases")
'Перебираем результаты запроса
While Not objRecordset.EOF
    strRes = vbNullString
    For i=0 To objRecordset.Fields.Count-1
        strRes = strRes & CStr(objRecordset.Fields(i).Value) & vbTab
    Next
    WScript.Echo Trim(strRes)
    objRecordset.MoveNext
Wend
'Закрываем соединение
objConn.Close
Set objConn = Nothing
Set objRecordset = Nothing
</pre>
</span>
</p>

<p class="paragraph">
Работаем с ошибками провайдера:
<br><br>
<span style="color:navy; font-weight:bold;">
<pre>
Set objConn = CreateObject("ADODB.Connection")
'Определяем параметры подключения к базе данных
ServerName = "(local)" 'имя или IP-адрес сервера
DSN = "master" 'имя базы данных
UID = "sa" 'логин пользователя SQL-сервера
PWD = "111" 'пароль пользователя SQL-сервера
ConnectString = "Provider=SQLOLEDB;" & _
                "bla-bla-bla=bla-bla-bla;" & _
                "Data Source=" & ServerName & _
                ";Initial Catalog=" & DSN & _
                ";UID=" & UID & ";PWD=" & PWD
objConn.ConnectionString = ConnectString
'Подключаемся к базе данных
objConn.Open
'Перебираем коллекцию ошибок
For Each E in objConn.Errors
    WScript.Echo "Error.Description: " & E.Description
    WScript.Echo "Error.Number: " & E.Number
    WScript.Echo "Error.Source: " & E.Source
    WScript.Echo "Error.SQLState: " & E.SQLState
    WScript.Echo "Error.NativeError: " & E.NativeError
    WScript.Echo
Next
'Закрываем соединение
objConn.Close
Set objConn = Nothing
</pre>
</span>
</p>

<p class="paragraph">
Пример асинхронного подключения и обработки событий:
<br><br>
<span style="color:navy; font-weight:bold;">
<pre>
Set objConn = WScript.CreateObject("ADODB.Connection", "Connection_")
'Определяем параметры подключения к базе данных
ServerName = "(local)" 'имя или IP-адрес сервера
DSN = "master" 'имя базы данных
UID = "sa" 'логин пользователя SQL-сервера
PWD = "111" 'пароль пользователя SQL-сервера
ConnectString = "Provider=SQLOLEDB" & _
                ";bla-bla=bla-bla" & _
                ";Data Source=" & ServerName & _
                ";Initial Catalog=" & DSN & _
                ";UID=" & UID & ";PWD=" & PWD
WScript.Echo "Подключаемся к базе данных (асинхронно)..."
objConn.Open ,,,16
WScript.Echo "objConn.State = " & objConn.State
WScript.Echo "Спим две секунды..."
WScript.Sleep 2000
WScript.Echo "Закончили спать."
WScript.Echo "Закрываем соединение..."
objConn.Close
WScript.Echo "Снова подключаемся к базе данных (асинхронно)..."
objConn.Open ,,,16
WScript.Echo "objConn.State = " & objConn.State
WScript.Echo "Отменяем соединение..."
objConn.Cancel
Set objConn = Nothing
Set objRecordset = Nothing
'************************************************
Function Connection_WillConnect(ConnectionString, UserID, _
                                Password, Options, adStatus, pConnection)
    pConnection.ConnectionString = ConnectString
    WScript.Echo "WillConnect event: pConnection.State = " & pConnection.State
End Function
Function Connection_ConnectComplete(pError, adStatus, pConnection)
    WScript.Echo "ConnectComplete event: pConnection.State = " & pConnection.State
End Function
Function Connection_Disconnect(adStatus, pConnection)
    WScript.Echo "Disconnect event: pConnection.State = " & pConnection.State
End Function
Function Connection_InfoMessage(pError, adStatus, pConnection)
    WScript.Echo "InfoMessage event: pError.Description = " & pError.Description
End Function
</pre>
</span>
</p>

<p class="paragraph">
Пример асинхронного выполнения запроса и обработки событий:
<br><br>
<span style="color:navy; font-weight:bold;">
<pre>
Set objConn = WScript.CreateObject("ADODB.Connection", "Connection_")
'Определяем параметры подключения к базе данных
ServerName = "(local)" 'имя или IP-адрес сервера
DSN = "master" 'имя базы данных
UID = "sa" 'логин пользователя SQL-сервера
PWD = "111" 'пароль пользователя SQL-сервера
ConnectString = "Provider=SQLOLEDB;" & _
                "Data Source=" & ServerName & _
                ";Initial Catalog=" & DSN & _
                ";UID=" & UID & ";PWD=" & PWD
objConn.ConnectionString = ConnectString
'Подключаемся к базе данных
objConn.Open
'Выполняем запрос (асинхронно)
Set objRecordset = objConn.Execute("SELECT name, filename FROM sysdatabases",,16)
'Ждём, пока выполнится запрос
While objConn.State &lt;&gt; 1
    WScript.Sleep 500
Wend
'Закрываем соединение
objConn.Close
Set objConn = Nothing
Set objRecordset = Nothing
'************************************************
Function Connection_ExecuteComplete(RecordsAffected, pError, adStatus, _
                                    pCommand, pRecordset, pConnection)
    'Перебираем результаты запроса
    While Not pRecordset.EOF
        strRes = vbNullString
        For i=0 To pRecordset.Fields.Count-1
            strRes = strRes & CStr(pRecordset.Fields(i).Value) & vbTab
        Next
        WScript.Echo Trim(strRes)
        pRecordset.MoveNext
    Wend
End Function
'************************************************
Function Connection_WillExecute(strSource, CursorType, LockType, Options, _
                                adStatus, pCommand, pRecordset, pConnection)
    CursorType = 2
    LockType = 2
    WScript.Echo "WillExecute event: CursorType = " & CursorType
    WScript.Echo "WillExecute event: LockType = " & LockType
    WScript.Echo "WillExecute event: Options = " & Options
End Function
</pre>
</span>
</p>

<p class="paragraph">
Пример работы с транзакциями:
<br><br>
<span style="color:navy; font-weight:bold;">
<pre>
Set objConn = WScript.CreateObject("ADODB.Connection", "Connection_")
'Определяем параметры подключения к базе данных
ServerName = "(local)" 'имя или IP-адрес сервера
DSN = "master" 'имя базы данных
UID = "sa" 'логин пользователя SQL-сервера
PWD = "111" 'пароль пользователя SQL-сервера
ConnectString = "Provider=SQLOLEDB;" & _
                "Data Source=" & ServerName & _
                ";Initial Catalog=" & DSN & _
                ";UID=" & UID & ";PWD=" & PWD
objConn.ConnectionString = ConnectString
'Подключаемся к базе данных
objConn.Open
'Начинаем транзакцию
objConn.BeginTrans
'Создаём таблицу
Set objRecordset = objConn.Execute("CREATE TABLE newTable (newColumn INT PRIMARY KEY)")
'Откатываем транзакцию
objConn.RollbackTrans
'Закрываем соединение
objConn.Close
Set objConn = Nothing
Set objRecordset = Nothing
'************************************************
Function Connection_BeginTransComplete(TransactionLevel, pError, _
                                       adStatus, pConnection)
    WScript.Echo "BeginTransComplete event: TransactionLevel = " & TransactionLevel
End Function
'************************************************
Function Connection_CommitTransComplete(pError, adStatus, pConnection)
    WScript.Echo "CommitTransComplete event"
End Function
'************************************************
Function Connection_RollbackTransComplete(pError, adStatus, pConnection)
    WScript.Echo "RollbackTransComplete event"
End Function
</pre>
</span>
</p>

<p class="paragraph">
Пример работы с методом OpenSchema:
<br><br>
<span style="color:navy; font-weight:bold;">
<pre>
Set objConn = CreateObject("ADODB.Connection")
'Определяем параметры подключения к базе данных
ServerName = "(local)" 'имя или IP-адрес сервера
DSN = "master" 'имя базы данных
UID = "sa" 'логин пользователя SQL-сервера
PWD = "111" 'пароль пользователя SQL-сервера
ConnectString = "Provider=SQLOLEDB;" & _
                "Data Source=" & ServerName & _
                ";Initial Catalog=" & DSN & _
                ";UID=" & UID & ";PWD=" & PWD
objConn.ConnectionString = ConnectString
'Подключаемся к базе данных
objConn.Open
'Получаем данные о столбцах таблиц, которые являются доступными для
'данного пользователя. Фильтруем по базе данных "pubs", таблице "authors".
Set objRecordset = objConn.OpenSchema(4, Array("pubs", "dbo", "authors"))
'Перебираем результаты запроса
While Not objRecordset.EOF
    strRes = vbNullString
    For i=0 To objRecordset.Fields.Count-1
        If IsNull(objRecordset.Fields(i).Value) Then
            strRes = strRes & "NULL" & vbTab
        Else
            strRes = strRes & CStr(objRecordset.Fields(i).Value) & vbTab
        End If
    Next
    WScript.Echo Trim(strRes)
    objRecordset.MoveNext
Wend
'Закрываем соединение
objConn.Close
Set objConn = Nothing
Set objRecordset = Nothing
</pre>
</span>
</p>

<h2 style="text-indent:1.3em">Динамические свойства объектов</h2>

<p class="paragraph">
Объекты Connection, Command, Recordset, Parameter и Field имеют встроенную коллекцию Properties, содержащую объекты
Property. Коллекция имеет следующие свойства и методы:
<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>Count - содержит количество объектов в коллекции.</LI>
<LI>Item(index) -  возвращает элемент коллекции по имени или порядковому номеру.</LI>
<LI>Refresh() - обновляет коллекцию, чтобы отразить доступные объекты, определённые провайдером.</LI>
</UL>
Объект Property представляет динамические характеристики объекта ADO, которые определяются провайдером
данных. Объект Property обладает следующими свойствами:
<br><br>
<TABLE border="1" width="100%" cellspacing="0">
<TR><TH></TH><TH>Описание</TH></TR>

<TR>
<TD>Name</TD>
<TD>Содержит имя свойства (строка).</TD>
</TR>

<TR>
<TD>Type</TD>
<TD>Содержит тип свойства. Может принимать значения перечисления DataTypeEnum (подробнее - см. MSDN, а также
свойство Type объекта Parameter в данной статье).</TD>
</TR>

<TR>
<TD>Value</TD>
<TD>Содержит значение свойства.</TD>
</TR>

<TR>
<TD>Attributes</TD>
<TD>Содержит одну или несколько характеристик свойства - сумму одной или более констант:
<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>adPropNotSupported(0) - провайдер не поддерживает это свойство.</LI>
<LI>adPropRequired(1) - пользователь должен задать значение данного свойства перед инициализацией источника
данных.</LI>
<LI>adPropOptional(2) - пользователю не требуется задавать значение данного свойства перед инициализацией источника
данных.</LI>
<LI>adPropRead(512) - данное свойство доступно для чтения.</LI>
<LI>adPropWrite(1024) - пользователь может задать значение данному свойству.</LI>
</UL>
</TD>
</TR>

</TABLE>
<br>
</p>

<p class="paragraph">
Вы можете изменять значения (Value) этих свойств, но не их характеристики (Attributes). Вы не можете удалить такое
свойство.
</p>

<p class="paragraph">
Чтение коллекции Properties:
<br><br>
<span style="color:navy; font-weight:bold;">
<pre>
Set objConn = CreateObject("ADODB.Connection")
'Определяем параметры подключения к базе данных
ServerName = "(local)" 'имя или IP-адрес сервера
DSN = "master" 'имя базы данных
UID = "sa" 'логин пользователя SQL-сервера
PWD = "111" 'пароль пользователя SQL-сервера
ConnectString = "Provider=SQLOLEDB;" & _
                "Data Source=" & ServerName & _
                ";Initial Catalog=" & DSN & _
                ";UID=" & UID & ";PWD=" & PWD
objConn.ConnectionString = ConnectString
'Подключаемся к базе данных
objConn.Open
'Перебираем коллекцию динамических свойств
i=1
For Each Prop in objConn.Properties
    WScript.Echo i
    WScript.Echo "Property.Name: " & Prop.Name
    WScript.Echo "Property.Type: " & Prop.Type
    WScript.Echo "Property.Value: " & Prop.Value
    WScript.Echo "Property.Attributes: " & Prop.Attributes
    If (Prop.Attributes And 1) = 1 Then
    	WScript.Echo "необходимо задать значение свойства перед инициализацией источника данных: ДА"
    Else
    	WScript.Echo "необходимо задать значение свойства перед инициализацией источника данных: НЕТ"
    End If
    If (Prop.Attributes And 2) = 2 Then
    	WScript.Echo "не требуется задавать значение свойства перед инициализацией источника данных: ДА"
    Else
    	WScript.Echo "не требуется задавать значение свойства перед инициализацией источника данных: НЕТ"
    End If
    If (Prop.Attributes And 512) = 512 Then
    	WScript.Echo "свойство доступно для чтения: ДА"
    Else
    	WScript.Echo "свойство доступно для чтения: НЕТ"
    End If
    If (Prop.Attributes And 1024) = 1024 Then
    	WScript.Echo "свойство доступно для записи: ДА"
    Else
    	WScript.Echo "свойство доступно для записи: НЕТ"
    End If
    WScript.Echo
    i=i+1
Next
'Закрываем соединение
objConn.Close
Set objConn = Nothing
</pre>
</span>
</p>

<p class="paragraph">
Смена текущей базы данных с помощью коллекции Properties:
<br><br>
<span style="color:navy; font-weight:bold;">
<pre>
Set objConn = CreateObject("ADODB.Connection")
'Определяем параметры подключения к базе данных
ServerName = "(local)" 'имя или IP-адрес сервера
DSN = "master" 'имя базы данных
UID = "sa" 'логин пользователя SQL-сервера
PWD = "111" 'пароль пользователя SQL-сервера
ConnectString = "Provider=SQLOLEDB;" & _
                "Data Source=" & ServerName & _
                ";Initial Catalog=" & DSN & _
                ";UID=" & UID & ";PWD=" & PWD
objConn.ConnectionString = ConnectString
objConn.ConnectionTimeOut = 15
objConn.CommandTimeout = 30
'Подключаемся к базе данных
objConn.Open
'Выполняем запрос
Set objRecordset = objConn.Execute("SELECT name, filename FROM sysdatabases")
'Перебираем результаты запроса
While Not objRecordset.EOF
    strRes = vbNullString
    For i=0 To objRecordset.Fields.Count-1
        strRes = strRes & CStr(objRecordset.Fields(i).Value) & vbTab
    Next
    WScript.Echo Trim(strRes)
    objRecordset.MoveNext
Wend
WScript.Echo
'Меняем текущую базу данных
objConn.Properties("Current Catalog").Value = "pubs"
'Выполняем запрос
Set objRecordset = objConn.Execute("SELECT au_lname, au_fname FROM authors")
'Перебираем результаты запроса
While Not objRecordset.EOF
    strRes = vbNullString
    For i=0 To objRecordset.Fields.Count-1
        strRes = strRes & CStr(objRecordset.Fields(i).Value) & vbTab
    Next
    WScript.Echo Trim(strRes)
    objRecordset.MoveNext
Wend
'Закрываем соединение
objConn.Close
Set objConn = Nothing
Set objRecordset = Nothing
</pre>
</span>
</p>

<h2 style="text-indent:1.3em"><a name="CommandObject">Объект Command</a></h2>

<p class="paragraph">
Объект Command создаётся следующим образом:
<br><br>
<span style="color:navy; font-weight:bold;">
Set objComm = CreateObject("ADODB.Command")
</span>
<br><br>
После этого вы можете вызывать и использовать методы и свойства этого объекта.
</p>

<p class="paragraph">
Объект Command существует для задания и выполнения команд и запросов. Хотя запрос можно выполнить и без
использования объекта Command (с помощью метода Execute объекта Connection или метода Open объекта Recordset),
объект Command незаменим при выполнении запроса с <i>параметрами</i> и удобен в случае, когда требуется сохранить
текст команды для её повторного использования. Объект Command может быть использован как в паре с объектом
Connection, так и без него, т.к. строку подключения можно задать непосредственно в свойстве ActiveConnection
объекта Command.
</p>

<p class="paragraph">
Свойства и методы объекта Command:
<br><br>
<TABLE border="1" width="100%" cellspacing="0">
<TR><TH></TH><TH>Описание</TH></TR>

<TR>
<TD>ActiveConnection</TD>
<TD>Определяет объект Connection, с которым связан данный объект Command. Значением этого свойства может быть и
строка, содержащая ту же информацию, что и свойство ConnectionString объекта Connection. Попытка выполнить метод
Execute объекта Command при незаданном свойстве ActiveConnection приведёт к ошибке. Назначение закрытого объекта
Connection в качестве значения свойства ActiveConnection также вызовет ошибку (объект должен быть открыт). Закрытие
объекта Connection, с которым связан объект Command, устанавливает свойство ActiveConnection в Nothing.</TD>
</TR>

<TR>
<TD>CommandText</TD>
<TD>Строка, определяющая текст команды, например, оператор SQL, имя таблицы или вызов хранимой процедуры. В
зависимости от установки свойства CommandType, ADO может автоматически изменить свойство CommandText.</TD>
</TR>

<TR>
<TD>CommandTimeout</TD>
<TD>Устанавливает или возвращает число секунд ожидания выполнения команды. Значение по умолчанию - 30. Чтение и
запись. Используйте это свойство, если возникают проблемы из-за плотного сетевого трафика или загруженности сервера.
Если время, указанное в CommandTimeout, истекает до завершения выполнения команды, происходит ошибка, и ADO отменяет
команду. Если Вы установите свойство в ноль, ADO будет ждать бесконечно, пока команда не будет выполнена.
Удостоверьтесь, что используемый провайдер поддерживает свойство CommandTimeout. Установка CommandTimeout объекта
Connection никак не связана с установкой свойства CommandTimeout объекта Command.</TD>
</TR>

<TR>
<TD>CommandType</TD>
<TD>Определяет тип команды. Возможные значения:
<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>adCmdUnspecified(-1) - тип команды не определён.</LI>
<LI>adCmdText(1) - текстовое определение команды или хранимой процедуры.</LI>
<LI>adCmdTable(2) - создать SQL-запрос, который вернёт все строки указанной таблицы.</LI>
<LI>adCmdStoredProc(4) - хранимая процедура.</LI>
<LI>adCmdUnknown(8) - тип команды неизвестен (по умолчанию).</LI>
</UL>
Если значение свойства равно adCmdUnknown (по умолчанию), команды могут выполняться медленнее, потому что
ADO должна делать запросы провайдеру, чтобы определить, является ли CommandText инструкцией SQL, хранимой процедурой
или именем таблицы. Если свойство CommandType не соответствует типу команды в свойстве CommandText, при вызове
метода Execute происходит ошибка.
</TD>
</TR>

<TR>
<TD>Prepared</TD>
<TD>Указывает, сохранить ли откомпилированную версию команды перед первым выполнением (true или false). Это может
замедлить первое выполнение команды, но ускорит любое последующее выполнение. Если провайдер не поддерживает
компиляцию команды, при установке этого свойства в true может произойти ошибка (или автоматическая установка в
false).</TD>
</TR>

<TR>
<TD>State</TD>
<TD>Содержит состояние объекта. Только чтение. Возможные значения:
<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>adStateClosed(0) - объект закрыт.</LI>
<LI>adStateOpen(1) - объект открыт.</LI>
<LI>adStateConnecting(2) - объект соединяется.</LI>
<LI>adStateExecuting(4) - объект выполняет команду.</LI>
<LI>adStateFetching(8) - объект выполняет выборку строк.</LI>
</UL>
Свойство State может иметь комбинацию значений. Например, если асинхронно выполняется инструкция, это свойство будет
иметь объединенное значение adStateOpen и adStateExecuting.
</TD>
</TR>

<TR>
<TD>Properties</TD>
<TD>Содержит коллекцию динамических свойств объекта (объектов Property). Подробнее - см. раздел "Динамические
свойства объектов".</TD>
</TR>

<TR>
<TD>Parameters</TD>
<TD>Содержит коллекцию параметров объекта (объектов Parameter). Использование метода Refresh() этой коллекции
отыскивает информацию параметров для хранимой процедуры или параметрического запроса. Некоторые провайдеры
не поддерживают хранимые процедуры или параметрические запросы; в этом случае вызов метода Refresh() вызовет
ошибку. Перед вызовом метода Refresh() вы должны правильно установить значения свойств ActiveConnection, CommandText
и CommandType. Если вы обращаетесь к коллекции перед вызовом метода Refresh(), ADO автоматически вызовет его и
заполнит коллекцию. Коллекция параметров имеет следующие свойства и методы:
<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>Count - содержит количество объектов в коллекции.</LI>
<LI>Item(index) - возвращает элемент коллекции по имени или порядковому номеру.</LI>
<LI>Append(object) - добавляет предварительно созданный объект в коллекцию.</LI>
<LI>Delete(index) - удаляет элемент из коллекции по имени или порядковому номеру.</LI>
<LI>Refresh() - обновляет коллекцию, чтобы отразить доступные объекты, определённые провайдером.</LI>
</UL>
</TD>
</TR>

<TR>
<TD>NamedParameters</TD>
<TD>Указывает, нужно ли передавать провайдеру имена параметров. Булево (по умолчанию - ложь). Если это свойство
установлено в True, ADO передаёт значение имени каждого параметра в коллекции параметров. Провайдер использует имя
параметра, чтобы установить соответствие параметрам в свойстве CommandText. Если это свойство установлено в ложь,
имена параметров игнорируются, и провайдер использует порядок параметров, чтобы установить соответствие параметрам
в свойстве CommandText.</TD>
</TR>

<TR>
<TD>Execute(RecordsAffected, Parameters, Options)</TD>
<TD>Выполняет запрос, оператор SQL, хранимую процедуру или любую другую команду, доступную провайдеру. В основном
аналогичен методу Execute() объекта Connection (см. выше). Все параметры являются необязательными. Параметр
"Parameters" представляет собой массив параметров типа Variant, передаваемый оператору SQL (не для выходных
параметров).</TD>
</TR>

<TR>
<TD>Cancel()</TD>
<TD>Отменяет выполнение последнего асинхронного вызова Execute(), если действие ещё не завершено.</TD>
</TR>

<TR>
<TD>CreateParameter(Name, Type, Direction, Size, Value)</TD>
<TD>Создаёт и возвращает объект Parameter с заданными свойствами. Метод CreateParameter не добавляет созданный
параметр к коллекции Parameters. Для этого следует использовать метод Append(objParameter) этой коллекции.
Аргументы метода CreateParameter (все аргументы необязательные):
<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>Name - строка, имя параметра.</LI>
<LI>Type - целое число (long), тип данных параметра (строка, число, булево и т.д.). Подробнее - см. в MSDN
значения перечисления DataTypeEnum, а также свойство Type объекта Parameter в данной статье.</LI>
<LI>Direction - целое число (long), "направление" параметра. Возможные значения:
<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>adParamUnknown(0) - направление параметра неизвестно.</LI>
<LI>adParamInput(1) - по умолчанию, входной параметр.</LI>
<LI>adParamOutput(2) - выходной параметр.</LI>
<LI>adParamInputOutput(3) -  параметр представляет собой и входной, и выходной параметр</LI>
<LI>adParamReturnValue(4) - параметр представляет собой возвращаемое значение.</LI>
</UL>
</LI>
<LI>Size - целое число (long), максимальная длина параметра в символах или байтах.</LI>
<LI>Value - Variant, значение параметра.</LI>
</UL>
</TD>
</TR>

</TABLE>
<br>
</p>

<p class="paragraph">
Объект Parameter является членом коллекции Parameters и представляет собой параметр запроса с параметрами
(например, критерий сравнения предложения WHERE оператора SELECT) или параметр хранимой процедуры. В зависимости
от функциональных возможностей провайдера некоторые методы или свойства объекта Parameter могут быть недоступны.
Если вы знаете имена и свойства параметров, связанных с хранимой процедурой или параметризованным запросом, вы
можете использовать метод CreateParameter для создания объектов Parameter и метод Append() для добавления их к
коллекции параметров. Это позволит вам не вызывать метод Refresh() коллекции параметров, чтобы отыскать информацию
о параметрах с помощью провайдера (потенциально ресурсоёмкая операция). Свойства и методы объекта Paramrter:
<br><br>
<TABLE border="1" width="100%" cellspacing="0">
<TR><TH></TH><TH>Описание</TH></TR>

<TR>
<TD>Name</TD>
<TD>Строка, имя параметра. Для объектов Parameter, ещё не добавленных в коллекцию параметров, это свойство доступно
для чтения и записи, в противном случае - только для чтения.</TD>
</TR>

<TR>
<TD>Value</TD>
<TD>Variant, значение параметра. Если команда содержит параметр, свойство Value которого пусто, и вы получаете
от команды объект Recordset, вы должны закрыть Recordset перед чтением свойства Value. Иначе (для некоторых
провайдеров) свойство Value может не содержать правильное значение.</TD>
</TR>

<TR>
<TD>Attributes</TD>
<TD>Содержит сумму одной или более характеристик объекта (целое число, long). Чтение и запись. Возможные значения:
<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>adParamSigned(16) - параметр принимает значения со знаком.</LI>
<LI>adParamNullable(64) - параметр принимает пустые значения.</LI>
<LI>adParamLong(128) - параметр принимает двоичные данные.</LI>
</UL>
</TD>
</TR>

<TR>
<TD>Direction</TD>
<TD>Целое число (long), "направление" параметра. Возможные значения - см. описание метода CreateParameter объекта
Command. Не все провайдеры могут определить направление параметров в их хранимых процедурах. В таких случаях вы
должны установить свойство Direction прежде, чем выполните запрос.</TD>
</TR>

<TR>
<TD>Precision</TD>
<TD>Указывает степень точности для числовых значений. Целое число (byte), которое указывает максимальное число
цифр.</TD>
</TR>

<TR>
<TD>NumericScale</TD>
<TD>Указывает масштаб числовых значений. Целое число (byte), которое указывает число десятичных разрядов справа
от десятичной точки.</TD>
</TR>

<TR>
<TD>Size</TD>
<TD>Целое число (long), максимальная длина параметра в символах или байтах. Во многих случаях во избежание ошибок
крайне желательно заполнить этот параметр.</TD>
</TR>

<TR>
<TD>Type</TD>
<TD>Целое число (long), тип данных параметра (строка, число, булево и т.д.). Подробнее - см. в MSDN значения
перечисления DataTypeEnum. Некоторые возможные значения:
<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>adEmpty(0) - значение не задано.</LI>
<LI>adSmallInt(2) - двухбайтное целое со знаком.</LI>
<LI>adInteger(3) - четырёхбайтное целое со знаком.</LI>
<LI>adSingle(4) - число с плавающей запятой с одинарной точностью.</LI>
<LI>adDouble(5) - число с плавающей запятой с двойной точностью.</LI>
<LI>adCurrency(6) - денежная сумма с фиксированной точкой с четырьмя цифрами справа от десятичной точки
(восьмибайтное целое число со знаком).</LI>
<LI>adError(10) - 32-битный код ошибки.</LI>
<LI>adBoolean(11) - булево значение.</LI>
<LI>adDecimal(14) -  числовое значение с фиксированной точностью и масштабом.</LI>
<LI>adTinyInt(16) - однобайтное целое со знаком.</LI>
<LI>adUnsignedTinyInt(17) - однобайтное целое без знака.</LI>
<LI>adUnsignedSmallInt(18) - двухбайтное целое без знака.</LI>
<LI>adUnsignedInt(19) - четырёхбайтное целое без знака.</LI>
<LI>adBigInt(20) - восьмибайтное целое со знаком.</LI>
<LI>adUnsignedBigInt(21) - восьмибайтное целое без знака.</LI>
<LI>adBinary(128) - двоичное значение.</LI>
<LI>adChar(129) - строковое значение.</LI>
<LI>adUserDefined(132) - определяемая пользователем переменная.</LI>
<LI>adDBDate(133) - дата формата yyyymmdd.</LI>
<LI>adDBTime(134) - время формата hhmmss.</LI>
<LI>adDBTimeStamp(135) - дата и время формата yyyymmddhhmmss плюс тысячные доли секунды.</LI>
</UL>
</TD>
</TR>

<TR>
<TD>AppendChunk(Data)</TD>
<TD>Добавляет данные в конец большого текста или двоичных данных. Параметр Data имеет тип Variant. В ситуациях,
когда системная память ограничена, вы можете использовать метод AppendChunk для управления большими значениями по
частям. Первый вызов AppendChunk() перезаписывает новые данные поверх любых существующих данных. Последующие вызовы
AppendChunk() добавляют данные к существующим данным параметра. Вызов AppendChunk() с пустым значением удаляет все
данные параметра.</TD>
</TR>

<TR>
<TD>Properties</TD>
<TD>Содержит коллекцию динамических свойств объекта (объектов Property). Подробнее - см. раздел "Динамические
свойства объектов".</TD>
</TR>

</TABLE>
<br>
</p>

<p class="paragraph">
Пример "независимого" использования объекта Command:
<br><br>
<span style="color:navy; font-weight:bold;">
<pre>
Set objComm = CreateObject("ADODB.Command")
ServerName = "(local)" 'имя или IP-адрес сервера
DSN = "master" 'имя базы данных
UID = "sa" 'логин пользователя SQL-сервера
PWD = "111" 'пароль пользователя SQL-сервера
ConnectString = "Provider=SQLOLEDB;" & _
                "Data Source=" & ServerName & _
                ";Initial Catalog=" & DSN & _
                ";UID=" & UID & ";PWD=" & PWD
objComm.ActiveConnection = ConnectString
objComm.CommandText = "SELECT name, filename FROM sysdatabases"
Set objRecordset = objComm.Execute
While Not objRecordset.EOF
    strRes = vbNullString
    For i=0 To objRecordset.Fields.Count-1
        strRes = strRes & CStr(objRecordset.Fields(i).Value) & vbTab
    Next
    WScript.Echo Trim(strRes)
    objRecordset.MoveNext
Wend
Set objComm = Nothing
Set objRecordset = Nothing
</pre>
</span>
</p>

<p class="paragraph">
Пример использования объекта Command в паре с объектом Connection:
<br><br>
<span style="color:navy; font-weight:bold;">
<pre>
Set objConn = CreateObject("ADODB.Connection")
Set objComm = CreateObject("ADODB.Command")
ServerName = "(local)" 'имя или IP-адрес сервера
DSN = "master" 'имя базы данных
UID = "sa" 'логин пользователя SQL-сервера
PWD = "111" 'пароль пользователя SQL-сервера
ConnectString = "Provider=SQLOLEDB;" & _
                "Data Source=" & ServerName & _
                ";Initial Catalog=" & DSN & _
                ";UID=" & UID & ";PWD=" & PWD
objConn.ConnectionString = ConnectString
objConn.Open
objComm.ActiveConnection = objConn
objComm.CommandText = "SELECT name, filename FROM sysdatabases"
Set objRecordset = objComm.Execute
While Not objRecordset.EOF
    strRes = vbNullString
    For i=0 To objRecordset.Fields.Count-1
        strRes = strRes & CStr(objRecordset.Fields(i).Value) & vbTab
    Next
    WScript.Echo Trim(strRes)
    objRecordset.MoveNext
Wend
objConn.Close
Set objConn = Nothing
Set objComm = Nothing
Set objRecordset = Nothing
</pre>
</span>
</p>

<p class="paragraph">
Пример получения информации о параметрах хранимой процедуры:
<br><br>
<span style="color:navy; font-weight:bold;">
<pre>
Set objComm = CreateObject("ADODB.Command")
ServerName = "(local)" 'имя или IP-адрес сервера
DSN = "master" 'имя базы данных
UID = "sa" 'логин пользователя SQL-сервера
PWD = "111" 'пароль пользователя SQL-сервера
ConnectString = "Provider=SQLOLEDB;" & _
                "Data Source=" & ServerName & _
                ";Initial Catalog=" & DSN & _
                ";UID=" & UID & ";PWD=" & PWD
objComm.ActiveConnection = ConnectString
'получаем информацию о параметрах хранимой процедуры "sp_adduser"
objComm.CommandText = "sp_adduser"
objComm.CommandType = 4
For Each Param In objComm.Parameters
    WScript.Echo "Name = " & Param.Name
    WScript.Echo "Attributes = " & Param.Attributes
    WScript.Echo "Direction = " & Param.Direction
    WScript.Echo "Size = " & Param.Size
    WScript.Echo "Type = " & Param.Type
    WScript.Echo
Next
Set objComm = Nothing
</pre>
</span>
</p>

<p class="paragraph">
Пример исполнения хранимой процедуры с параметрами - упаковка файла в CAB-архив средствами SQL-сервера:
<br><br>
<span style="color:navy; font-weight:bold;">
<pre>
Set objComm = CreateObject("ADODB.Command")
ServerName = "(local)" 'имя или IP-адрес сервера
DSN = "master" 'имя базы данных
UID = "sa" 'логин пользователя SQL-сервера
PWD = "111" 'пароль пользователя SQL-сервера
ConnectString = "Provider=SQLOLEDB;" & _
                "Data Source=" & ServerName & _
                ";Initial Catalog=" & DSN & _
                ";UID=" & UID & ";PWD=" & PWD
objComm.ActiveConnection = ConnectString
'упаковка файла "C:\boot.ini" в cab-архив
objComm.CommandText = "xp_makecab"
objComm.CommandType = 4
objComm.Parameters.Append objComm.CreateParameter(,129,,11,"C:\boot.cab")
objComm.Parameters.Append objComm.CreateParameter(,129,,5,"mszip")
objComm.Parameters.Append objComm.CreateParameter(,17,,,0)
objComm.Parameters.Append objComm.CreateParameter(,129,,11,"C:\boot.ini")
objComm.Execute
Set Param = Nothing
Set objComm = Nothing
</pre>
</span>
</p>

<h2 style="text-indent:1.3em"><a name="RecordsetObject">Объект Recordset</a></h2>

<p class="paragraph">
Объект Recordset создаётся следующим образом:
<br><br>
<span style="color:navy; font-weight:bold;">
Set objConn = CreateObject("ADODB.Recordset")
</span>
<br><br>
После этого вы можете вызывать и использовать методы и свойства этого объекта. Объект Recordset состоит из записей
и полей. Не все свойства объекта поддерживаются всеми провайдерами.
</p>

<p class="paragraph">
При открытии набора записей (Recordset'а) вы должны определить тип используемого курсора. В библиотеке ADO определены
четыре типа курсоров:
<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>Динамический курсор (Dynamic cursor). Позволяет видеть данные, добавленные, изменённые и удалённые другими
пользователями. Допускает все типы переходов по набору записей, а также использование закладок, если это позволяет
провайдер.</LI>
<LI>Курсор набора данных (Keyset cursor). Позволяет видеть данные, изменённые другими пользователями. Допускает все
типы переходов по набору записей, а также использование закладок, если это позволяет провайдер.</LI>
<LI>Статический курсор (Static cursor). Позволяет получить копию набора записей для создания отчёта. Допускает все
типы переходов по набору записей, а также использование закладок, если это позволяет провайдер.</LI>
<LI>Курсор Forward-only (Forward-only cursor). Аналогичен предыдущему, но позволяет проходить через набор записей
только вперёд. Обеспечивает максимальную производительность.</LI>
</UL>
</p>

<p class="paragraph">
Чтобы открыть набор записей в одном из рассмотренных четырёх режимов, необходимо задать соответствующее значение
свойству CursorType или параметру CursorType метода Open. Не все провайдеры поддерживают все типы курсоров. По
умолчанию используется курсор типа Forward-only.
</p>

<p class="paragraph">
При открытии объекта Recordset текущей записью становится первая запись, а свойства EOF и BOF получают значение
False.
</p>

<p class="paragraph">
Объект Recordset предусматривает два типа обновлений: немедленное и пакетное. В первом случае все изменения данных
немедленно записываются в базу после вызова метода Update(). Во втором случае (если тип блокировки для Recordset -
adLockBatchOptimistic(4), режим обновления будет пакетным) несколько обновлённых строк может помещаться в локальный
буфер, после чего реализуется одновременное обновление нескольких полей источника данных с помощью метода
UpdateBatch().
</p>

<p class="paragraph">
Свойства и методы объекта Recordset:
<br><br>
<TABLE border="1" width="100%" cellspacing="0">
<TR><TH></TH><TH>Описание</TH></TR>

<TR>
<TD>ActiveConnection</TD>
<TD>Содержит объект Connection, к которому привязан данный Recordset, или строку параметров подключения
(ConnectionString).</TD>
</TR>

<TR>
<TD>ActiveCommand</TD>
<TD>Содержит объект Command, который породил данный Recordset. Только чтение. Если объект Command не использовался,
пусто.</TD>
</TR>

<TR>
<TD>Source</TD>
<TD>Содержит источник данных объекта Recordset. Это ссылка на объект Command, оператор SQL, имя таблицы или
хранимой процедуры. Свойству можно задать значение только при закрытом в данный момент объекте Recordset.</TD>
</TR>

<TR>
<TD>Filter</TD>
<TD>Содержит фильтр данных. Может принимать значения трёх типов:
<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>Строка, составленная из одного или более индивидуальных предложений с операторами AND или OR, например
"LastName = 'Smith' AND FirstName = 'John'".</LI>
<LI>Массив закладок - уникальных значений Bookmark.</LI>
<LI>Одно из значений перечисления FilterGroupEnum (подробнее - см. MSDN).</LI>
</UL>
Используйте это свойство для выборочного сканирования объекта Recordset. Установка свойства переместит курсор на
первую запись, которая удовлетворяет фильтру.
</TD>
</TR>

<TR>
<TD>CursorType</TD>
<TD>Содержит тип курсора. Может быть изменено только до открытия объекта Recordset. Возможные значения - см.
описание аргумента CursorType события WillExecute объекта Connection.</TD>
</TR>

<TR>
<TD>LockType</TD>
<TD>Содержит тип блокировки для объекта Recordset. Доступно для записи при закрытом объекте Recordset. Возможные
значения - см. описание аргумента LockType события WillExecute объекта Connection.</TD>
</TR>

<TR>
<TD>MaxRecords</TD>
<TD>Используйте это свойство, чтобы ограничить количество записей, которые возвращает провайдер в результате
запроса к источнику данных. По умолчанию - 0, что означает, что провайдер возвращает все требуемые записи.</TD>
</TR>

<TR>
<TD>State</TD>
<TD>Содержит состояние объекта. Возможные значения - см. описание свойства State объекта Command.</TD>
</TR>

<TR>
<TD>CacheSize</TD>
<TD>Устанавливает количество записей объекта Recordset (обязательно больше 0), которые кэшируются (локально) в
памяти. Значение по умолчанию 1. Например, если CacheSize = 10, после открытия объекта Recordset провайдер помещает
первые 10 записей в локальную память. По мере того, как вы двигаетесь по записям объекта Recordset, провайдер
возвращает данные из локального буфера памяти. Как только вы минуете последнюю запись в кэше, провайдер помещает
следующие 10 записей из источника данных в кэш. Записи в кэше не отражают изменения, которые делают другие
пользователи. Чтобы вызвать модификацию всех кэшируемых данных, используйте метод Resync().
</TD>
</TR>

<TR>
<TD>Open(Source, ActiveConnection, CursorType, LockType, Options)</TD>
<TD>Открывает курсор. Все параметры необязательные. Параметры:
<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>Source - может принимать следующие значения:
<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>Ссылка на объект Command.</LI>
<LI>Строка с оператором SQL, именем таблицы или хранимой процедуры.</LI>
<LI>Имя файла с сохранённым набором записей.</LI>
</UL>
</LI>
<LI>ActiveConnection - ссылка на объект Connection или строка параметров подключения (ConnectionString).</LI>
<LI>CursorType - тип курсора. Возможные значения - см. описание аргумента CursorType события WillExecute объекта
Connection.</LI>
<LI>LockType - тип блокировки записей. Возможные значения - см. описание аргумента LockType события WillExecute
объекта Connection.</LI>
<LI>Options - целое число (long), определяющее тип команды. Возможные значения (значения можно суммировать):
<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>adCmdText(1) - текстовое определение команды или хранимой процедуры.</LI>
<LI>adCmdTable(2) - создать SQL-запрос, который вернёт все строки указанной таблицы.</LI>
<LI>adCmdStoredProc(4) - хранимая процедура.</LI>
<LI>adCmdUnknown(8) - тип команды неизвестен (по умолчанию).</LI>
<LI>adAsyncExecute(16) - асинхронное выполнение команды. Нельзя сочетать с adCmdTableDirect(512).</LI>
<LI>adAsyncFetch(32) - строки, не находящиеся в кеше (размер кеша определяется свойством CacheSize), будут выбраны
асинхронно.</LI>
<LI>adAsyncFetchNonBlocking(64) - никогда не осуществлять блокировки при поиске.</LI>
<LI>adCmdFile(256) - имя файла с сохранённым набором записей.</LI>
<LI>adCmdTableDirect(512) - создать SQL-запрос, который вернёт все строки указанной таблицы. Позволяет использовать
метод Seek() в паре со свойством Index (в данной статье не рассматриваются), если используется курсор на стороне
сервера.</LI>
</UL>
</LI>
</UL>
По умолчанию Recordset будет открыт с курсором forward-only read-only на стороне сервера.
</TD>
</TR>

<TR>
<TD>Close()</TD>
<TD>Закрывает объект Recordset. Если вы закрываете объект Recordset в пакетном режиме модификации, все изменения
после последнего вызова UpdateBatch() будут потеряны.</TD>
</TR>

<TR>
<TD>RecordCount</TD>
<TD>Содержит количество записей в объекте Recordset. Если провайдер или тип курсора не поддерживает данное свойство,
содержит -1.</TD>
</TR>

<TR>
<TD>Requery(Options)</TD>
<TD>Обновляет данные в объекте Recordset путём повторного выполнения запроса. Эквивалентно вызову Close(), а затем
Open(). Возможные значения параметра Options - см. описание аргумента Options метода Open() объекта Recordset.</TD>
</TR>

<TR>
<TD>Resync(AffectRecords, ResyncValues)</TD>
<TD>Обновляет данные в объекте Recordset. Не выполняет повторного запроса к базе данных, поэтому вновь добавленные
записи не будут видны. Если существующие записи были удалены из базы данных, произойдёт ошибка. Этот метод обычно
используют со статическим курсором или курсором типа Forward-only, чтобы видеть изменения, внесённые в базу
данных. Параметры (все параметры необязательные):
<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>AffectRecords - определяет записи, на которые воздействует метод. Возможные значения:
<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>adAffectCurrent(1) - обновляет только текущую запись.</LI>
<LI>adAffectGroup(2) - обновляет все записи, удовлетворяющие фильтру, заданному свойством Filter (например, если
Filter - массив "закладок").</LI>
<LI>adAffectAll(3) - по умолчанию. Обновляет все записи. Однако, если свойство Filter содержит строку типа
"Author ='Smith'", то операция затронет только часть записей.</LI>
<LI>adAffectAllChapters(4) - обновляет все записи.</LI>
</UL>
</LI>
<LI>ResyncValues - определяет возможность перезаписи значений основной таблицы. Возможные значения:
<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>adResyncAllValues(2) - по умолчанию. Осуществляет перезапись данных с отменой отложенных обновлений.</LI>
<LI>adResyncUnderlyingValues(1) - изменённые данные не перезаписываются и отложенные обновления не отменяются.</LI>
</UL>
</LI>
</UL>
</TD>
</TR>

<TR>
<TD>Save(FileName, PersistFormat)</TD>
<TD>Сохраняет набор записей в файл или объект Stream (не рассматривается в данной статье). Может быть вызван только
для открытого набора записей. После вызова метода текущей становится первая строка набора записей. Параметры (все
параметры необязательные):
<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>FileName - полное имя файла, в котором будет сохранён набор записей, или ссылка на объект Stream. По умолчанию
используется свойство Source как имя файла. В принципе, сюда можно поместить ссылку на любой объект, который
поддерживает OLE DB IStream интерфейс, например, MSXML DOM object ("MSXML.DOMDocument").</LI>
<LI>PersistFormat - формат, в котором будет сохранён набор записей. Возможные значения:
<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>adPersistADTG(0) - по умолчанию. Формат Microsoft Advanced Data TableGram (ADTG).</LI>
<LI>adPersistXML(1) - специфический формат XML ADO в кодировке UTF-8.</LI>
<LI>adPersistProviderSpecific(2) - собственный формат провайдера.</LI>
</UL>
</LI>
</UL>
Если установлено свойство Filter, будут сохранены только записи, удовлетворяющие фильтру.
</TD>
</TR>

<TR>
<TD>Clone(LockType)</TD>
<TD>Возвращает копию исходного объекта Recordset. Необязательный параметр LockType определяет тип блокировки:
как у оригинала или только для чтения. Допустимые значения - adLockUnspecified(-1) или adLockReadOnly(1).
Использование метода Clone() более эффективно, чем создание и открытие нового объекта Recordset с теми же
параметрами. Свойство Filter оригинала не будет применено к клону. Текущей записью только что созданного клона
будет первая. Изменения, которые вы делаете в оригинальном объекте Recordset, видимы во всех его клонах независимо
от типа курсора. Однако после того, как вы выполните метод Requery() на оригинале, клоны больше не будут
синхронизированы с оригиналом. Закрытие оригинала не закрывает копии.  Значения закладок (Bookmark) взаимозаменяемы
для оригинала и клонов. Некоторые события объекта Recordset (объект Recordset имеет события - в данной статье они не
рассматриваются) будут происходить одновременно для всех клонов. Однако, поскольку текущая запись оригинала может
отличаться от текущей записи клона, события могут быть неверно обработаны для клона.</TD>
</TR>

<TR>
<TD>BOF<br>EOF</TD>
<TD>Если свойство BOF содержит True, текущая запись (курсор) находится перед первой записью в объекте Recordset.
Если свойство EOF содержит True, текущая запись (курсор) находится после последней записи в объекте Recordset. При
открытии пустого объекта Recordset оба этих свойства содержат True.</TD>
</TR>

<TR>
<TD>Move(NumRecords, Start)</TD>
<TD>Передвигает позицию текущей записи в наборе записей. Параметры:
<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>NumRecords - целое число (long), количество записей, на которое перемещается позиция. При использовании
отрицательных значений позиция передвигается назад.</LI>
<LI>Start - необязательный. Может быть закладкой, с которой начинается отсчёт (см. свойство Bookmark). Другие
возможные значения:
<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>adBookmarkCurrent(0) - от текущей записи (по умолчанию).</LI>
<LI>adBookmarkFirst(1) - от первой записи.</LI>
<LI>adBookmarkLast(2) - от последней записи.</LI>
</UL>
</LI>
</UL>
Вызов метода для пустого набора записей приведёт к ошибке.
</TD>
</TR>

<TR>
<TD>MoveFirst()<br>MoveLast()<br>MoveNext()<br>MovePrevious()</TD>
<TD>Передвигают позицию текущей записи соответственно на первую, последнюю, следующую или предыдущую запись. Вызов
MoveFirst() в объекте Recordset типа forward-only может заставить провайдера заново выполнить команду, которая
сгенерировала этот Recordset.</TD>
</TR>

<TR>
<TD>AbsolutePosition</TD>
<TD>При установке перемещает курсор на запись под данным номером. Доступно не для всех видов курсоров. Значение
в интервале с 1 по RecordCount. Свойство поддерживается не всеми провайдерами.</TD>
</TR>

<TR>
<TD>Bookmark</TD>
<TD>Закладка в виде числа. Доступно не для всех видов курсоров. Никак не связана с номером записи. Можно при
проходе по таблице запомнить значение Bookmark во временной переменной, а затем вернуться обратно на данную
запись путём установки свойства из этой переменной. Закладка уникально идентифицирует запись. Тип данных закладки
определяется провайдером и воспринимается ADO как Variant.</TD>
</TR>

<TR>
<TD>PageSize</TD>
<TD>Задаёт число записей на странице. По умолчанию - 10. Доступно не для всех видов курсоров.</TD>
</TR>

<TR>
<TD>PageCount</TD>
<TD>Содержит количество страниц. Автоматически пересчитывается при изменении PageSize. Доступно не для всех видов
курсоров.</TD>
</TR>

<TR>
<TD>AbsolutePage</TD>
<TD>При установке перемещает курсор на начало данной страницы. Доступно не для всех видов курсоров. Значение
в интервале с 1 по PageCount. Свойство поддерживается не всеми провайдерами.</TD>
</TR>

<TR>
<TD>Delete(AffectRecords)</TD>
<TD>Удаляет текущую запись или группу записей. Если объект Recordset не допускает удаления записей, произойдёт
ошибка. Если вы находитесь в пакетном режиме модификации, фактическое удаление происходит при вызове UpdateBatch().
Вы можете отменить удаление вызовом CancelBatch(). Параметр AffectRecords (необязательный) может принимать
значения:
<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>adAffectCurrent(1) - удаляется текущая запись (по умолчанию).</LI>
<LI>adAffectGroup(2) - удаляются все записи, удовлетворяющие фильтру, заданному свойством Filter.</LI>
</UL>
</TD>
</TR>

<TR>
<TD>AddNew(Fields, Values)</TD>
<TD>Добавляет запись с указанными значениями полей в конец объекта Recordset и делает её текущей. Параметры (все
параметры необязательные):
<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>Fields - имя поля или массив имён полей, для которых задаются значения.</LI>
<LI>Values - значение поля или массив значений полей.</LI>
</UL>
Чтобы сохранить добавленную запись, необходимо вызвать метод Update(). При непосредственном режиме модификации,
если вы передаете параметры Fieldlist и Values, ADO немедленно отправляет новую запись в базу данных (вызов
Update() не нужен). В пакетном режиме модификации для сохранения записи в базе данных нужно вызвать метод
UpdateBatch().
</TD>
</TR>

<TR>
<TD>Update(Fields, Values)</TD>
<TD>Сохраняет любые изменения текущей записи объекта Recordset. Параметры (все параметры необязательные):
<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>Fields - имя поля или массив имён полей, в которых следует сохранить изменения.</LI>
<LI>Values - значение поля или массив значений полей.</LI>
</UL>
Если курсор перемещён с добавленной или изменённой записи, метод вызывается автоматически.
</TD>
</TR>

<TR>
<TD>CancelUpdate()</TD>
<TD>Отменяет любые изменения или добавления записей, проведённые до использования метода Update().</TD>
</TR>

<TR>
<TD>UpdateBatch(AffectRecords, PreserveStatus)</TD>
<TD>Для пакетного режима модификации: записывает все изменения объекта Recordset в базу данных. Только для
курсоров Keyset или Static. Если вызов метода привёл к ошибкам из-за конфликта с основными данными (например,
запись была уже удалена другим пользователем), используйте коллекцию Errors и обрабатывайте ошибки времени
выполнения (run-time errors). Используйте свойства Filter и Status, чтобы определить местонахождение
записей с конфликтами. Чтобы отменить все ожидающие разрешения пакетные модификации, используйте метод
CancelBatch(). Порядок, в котором модификации выполняются на источнике данных, не обязательно тот же,
в котором эти модификации были выполнены в текущем объекте Recordset. Параметры (все параметры необязательные):
<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>AffectRecords - указывает, какие записи затронет метод. Возможные значения - см. описание аргумента
AffectRecords метода Resync().</LI>
<LI>PreserveStatus - если установлено в True, свойство Status каждой записи остаётся неизменным.</LI>
</UL>
</TD>
</TR>

<TR>
<TD>CancelBatch(AffectRecords)</TD>
<TD>Отменяет любые ожидающие разрешения модификации в пакетном режиме модификации. Обработка ошибок аналогична
методу UpdateBatch(). Необязательный параметр AffectRecords указывает, какие записи затронет метод. Возможные
значения - см. описание аргумента AffectRecords метода Resync().</TD>
</TR>

<TR>
<TD>Status</TD>
<TD>Содержит статус текущей записи относительно пакетных модификаций или других объёмных операций. Возможные
значения - см. в MSDN описание перечисления RecordStatusEnum.</TD>
</TR>

<TR>
<TD>SetAllRowStatus(recStatus)</TD>
<TD>Устанавливает свойство Status всех записей к указанному значению. Единственное допустимое значение аргумента
recStatus - adRecNew(1) - указывает, что запись новая.</TD>
</TR>

<TR>
<TD>EditMode</TD>
<TD>Содержит состояние редактирования текущей записи (был ли вызван метод Update() или UpdateBatch() для сохранения
изменений). Возможные значения:
<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>adEditNone(0) - редактирование не проводилось.</LI>
<LI>adEditInProgress(1) - редактирование проводилось, но изменения не сохранены.</LI>
<LI>adEditAdd(2) - текущая запись добавлена с помощью метода AddNew(), но ещё не сохранена.</LI>
<LI>adEditDelete(4) - текущая запись была удалена.</LI>
</UL>
</TD>
</TR>

<TR>
<TD>Cancel()</TD>
<TD>Отменяет последний асинхронный вызов Open(), если процесс ещё не завершён.</TD>
</TR>

<TR>
<TD>Fields</TD>
<TD>Содержит коллекцию полей (объектов Field). Свойства и методы коллекции - см. раздел "Коллекция полей
Fields".</TD>
</TR>

<TR>
<TD>Properties</TD>
<TD>Содержит коллекцию динамических свойств объекта (объектов Property). Подробнее - см. раздел "Динамические
свойства объектов". Доступно для открытого объекта Recordset.</TD>
</TR>

<TR>
<TD>CursorLocation</TD>
<TD>Определяет расположение курсора (на сервере или на клиенте). Доступно для установки только до осуществления
подключения к источнику данных. Возможные значения:
<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>adUseNone(1) - не использовать курсор (устарело; только ради совместимости).</LI>
<LI>adUseServer(2) - по умолчанию. Курсор на стороне сервера.</LI>
<LI>adUseClient(3) - курсор на стороне клиента. Может обеспечивать дополнительные возможности (например,
сортировку).</LI>
</UL>
</TD>
</TR>

<TR>
<TD>Sort</TD>
<TD>Строка, содержащая одно или более имен полей, по которым следует отсортировать Recordset, и порядок сортировки
(по возрастанию или по убыванию). Каждое имя поля отделяется запятой и произвольно сопровождается пробелом и
ключевым словом ASC, которое сортирует в возрастающем порядке, или DESC, которое сортирует по убыванию. По
умолчанию сортировка происходит в возрастающем порядке. Это свойство требует, чтобы свойство CursorLocation было
установлено в adUseClient(3). Это свойство имеет приоритет перед предложением ORDER BY, включенным в инструкцию
SQL. Установка свойства к пустой строке сбросит строки к их первоначальному порядку.</TD>
</TR>

<TR>
<TD>CompareBookmarks(Bookmark1, Bookmark2)</TD>
<TD>Сравнивает относительную позицию двух закладок (см. свойство Bookmark) и возвращает результат сравнения.
Возвращаемые значения:
<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>adCompareLessThan(0) - первая закладка перед второй.</LI>
<LI>adCompareEqual(1) - закладки равны.</LI>
<LI>adCompareGreaterThan(2) - первая закладка после второй.</LI>
<LI>adCompareNotEqual(3) - закладки не равны и не упорядочены.</LI>
<LI>adCompareNotComparable(4) - закладки не могут быть сравнены.</LI>
</UL>
Закладки должны принадлежать одному и тому же объекту Recordset, или его клону.
</TD>
</TR>

<TR>
<TD>NextRecordset(RecordsAffected)</TD>
<TD>Используйте этот метод, чтобы получить результаты следующей команды в составной инструкции, которая возвращает
множественные результаты. Если вы открываете объект Recordset, основанный на составной инструкции (например,
"SELECT * FROM table1; SELECT * FROM table2"), использование метода Open() возвращает результаты только первой
команды. Если результатов следующей команды нет, Recordset будет установлен в Nothing. При непосредственном режиме
модификации перед использованием метода NextRecordset следует вызвать Update() или CancelUpdate(), т.к. модификации
должны быть завершены. Метод возвращает объект Recordset. В необязательном параметре RecordsAffected возвращается
число записей, затронутых операцией.</TD>
</TR>

<TR>
<TD>Supports(CursorOptions)</TD>
<TD>Определяет, поддерживает ли текущий курсор Recordset специфический тип функциональных возможностей и возвращает
булево значение. Параметр CursorOptions состоит из одного или более значений:
<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>adAddNew(0x1000400) - поддерживает метод AddNew() для добавления записей.</LI>
<LI>adApproxPosition(0x4000) - поддерживает свойства AbsolutePosition и AbsolutePage.</LI>
<LI>adBookmark(0x2000) - поддерживает свойство Bookmark.</LI>
<LI>adDelete(0x1000800) - поддерживает метод Delete() для удаления записей.</LI>
<LI>adFind(0x80000) - поддерживает метод Find() для определения местонахождения строки в Recordset.</LI>
<LI>adHoldRecords(0x100) - отыскивает записи или изменяет позицию, не передавая все ожидающие разрешения
изменения.</LI>
<LI>adIndex(0x100000) - поддерживает свойство Index.</LI>
<LI>adMovePrevious(0x200) - поддерживает методы MoveFirst() и MovePrevious(), методы Move() и GetRows() для
перемещения текущей позиции назад, не требуя закладок.</LI>
<LI>adNotify(0x40000) - указывает, что провайдер данных поддерживает события объекта Recordset (в данной статье
события не рассматриваются).</LI>
<LI>adResync(0x20000) - поддерживает метод Resync.</LI>
<LI>adSeek(0x200000) - поддерживает метод Seek() для определения местонахождения строки в Recordset.</LI>
<LI>adUpdate(0x1008000) - поддерживает метод Update().</LI>
<LI>adUpdateBatch(0x10000) - поддерживает методы UpdateBatch() и CancelBatch().</LI>
</UL>
</TD>
</TR>

<TR>
<TD>Find(Criteria, SkipRows, SearchDirection, Start)</TD>
<TD>Ищет в Recordset строку, которая удовлетворяет указанным критериям. Если строка найдена, она становится
текущей. Иначе, текущая позиция устанавливается на конец (или начало) Recordset. Перед вызовом метода текущая
позиция должна быть установлена. Параметры:
<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>Criteria - строка, которая содержит инструкцию, определяющую имя столбца, оператор сравнения и значение. Может
быть определено имя только единственного столбца. Оператором сравнения может быть &lt;, &gt;, =, &lt;=, &gt;=,
&lt;&gt; или "like". Значение может быть строкой, числом с плавающей запятой или датой. Cтроки берутся в одинарные
кавычки или # (знаки номера). Даты ограничиваются знаками номера и могут содержать часы, минуты и секунды, но не
миллисекунды. Для оператора "like" значение строки может содержать звездочку (*). Звездочка может использоваться
только в конце строки значения, или в начале и конце строки одновременно, и никак иначе. Пример: "start_date &gt;
#7/22/97#".</LI>
<LI>SkipRows - необязательный. Целое число (long), значение по умолчанию которого является нулевым, которое
определяет смещение строки от текущей строки или закладки Start (см. ниже), чтобы начать поиск. По умолчанию, поиск
начнётся с текущей строки.</LI>
<LI>SearchDirection - необязательный. Определяет направление поиска. Возможные значения:
<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>adSearchBackward(-1) - Поиск назад. Если соответствие не найдено, указатель текущей записи будет установлен в
BOF.</LI>
<LI>adSearchForward(1) - Поиск вперёд. Если соответствие не найдено, указатель текущей записи будет установлен в
EOF.</LI>
</UL>
</LI>
<LI>Start - необязательный. Закладка (Bookmark), которая используется как начальная позиция для поиска.</LI>
</UL>
</TD>
</TR>

<TR>
<TD>GetRows(Rows, Start, Fields)</TD>
<TD>Помещает записи объекта Recordset в массив. Возвращает двумерный массив. Параметры:
<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>Rows - необязательный. Единственно возможное значение и значение по умолчанию - adGetRowsRest(-1). Отыскивает
все записи Recordset от текущей позиции или от закладки, указанной параметром Start.</LI>
<LI>Start - необязательный. Закладка (Bookmark), которая используется как начальная позиция для поиска.</LI>
<LI>Fields - необязательный. Имя или порядковая позиция поля, либо массив имен или порядковых позиций полей. ADO
возвращает только данные из этих полей.</LI>
</UL>
</TD>
</TR>

<TR>
<TD>GetString(StringFormat, NumRows, ColumnDelimiter, RowDelimiter, NullExpr)</TD>
<TD>Возвращает Recordset как строку. Параметры:
<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>StringFormat - формат строки. Единственно возможное значение - adClipString(2) - разграничивает строки, столбцы
и пустые значения с помощью параметров RowDelimiter, ColumnDelimiter и NullExpr.</LI>
<LI>NumRows - необязательный. Число строк, которые будут возвращены из Recordset. Если NumRows не определён или
превышает общее количество строк в Recordset, будут возвращены все строки.</LI>
<LI>ColumnDelimiter - необязательный. Разделитель столбцов. Если не определено, cимвол табуляции.</LI>
<LI>RowDelimiter - необязательный. Разделитель строк. Если не определено, символ возврата каретки.</LI>
<LI>NullExpr - необязательный. Выражение, используемое вместо пустого значения (Null). Если не определено, пустая
строка.</LI>
</UL>
</TD>
</TR>

</TABLE>
<br>
</p>

<h2 style="text-indent:1.3em">Коллекция полей Fields</h2>

<p class="paragraph">
Коллекция полей Fields является свойством объекта Recordset и поддерживает следующие свойства и методы:
<br><br>
<TABLE border="1" width="100%" cellspacing="0">
<TR><TH></TH><TH>Описание</TH></TR>

<TR>
<TD>Count</TD>
<TD>Содержит количество объектов в коллекции.</TD>
</TR>

<TR>
<TD>Item(index)</TD>
<TD>Возвращает элемент коллекции по имени или порядковому номеру.</TD>
</TR>

<TR>
<TD>Append(Name, Type, DefinedSize, Attrib)</TD>
<TD>Создаёт и добавляет новый объект Field в коллекцию. Поля следует добавлять к закрытому Recordset'у. Параметры:
<UL style="text-indent:0em; margin-top:5; margin-bottom:5;">
<LI>Name - уникальное имя поля.</LI>
<LI>Type - тип поля. Возможные значения - см. описание свойства "Type" объекта "Parameter".</LI>
<LI>DefinedSize - необязательный. Размер поля в символах или байтах.</LI>
<LI>Attrib - необязательный. Атрибуты поля. Возможные значения - см. в MSDN описание перечисления
FieldAttributeEnum.</LI>
</UL>
</TD>
</TR>

<TR>
<TD>Delete(Field)</TD>
<TD>Удаляет объект Field из коллекции, что соответствует удалению поля из набора записей. Параметр Field задаёт
имя объекта Field или его порядковый номер. Метод может использоваться только для закрытого набора записей.</TD>
</TR>

</TABLE>
<br>
</p>

<h2 style="text-indent:1.3em">Объект Field</h2>

<p class="paragraph">
Объект Field представляет собой столбец данных одного типа, т.е. поле набора записей. Кроме того, объект Field
может представлять собой поле единичной записи (объекта Record, который не рассматривается в данной статье).
Свойства объекта Field:
<br><br>
<TABLE border="1" width="100%" cellspacing="0">
<TR><TH></TH><TH>Описание</TH></TR>

<TR>
<TD>Name</TD>
<TD>Содержит имя поля.</TD>
</TR>

<TR>
<TD>Value</TD>
<TD>Содержит значение поля.</TD>
</TR>

<TR>
<TD>OriginalValue</TD>
<TD>Содержит значение поля после последнего вызова Update() или UpdateBatch(). Это то значение, которое используют
методы CancelUpdate() и CancelBatch().</TD>
</TR>

<TR>
<TD>UnderlyingValue</TD>
<TD>Содержит текущее значение поля из источника данных.</TD>
</TR>

<TR>
<TD>DefinedSize</TD>
<TD>Содержит максимальный размер поля.</TD>
</TR>

<TR>
<TD>ActualSize</TD>
<TD>Содержит размер фактического значения поля.</TD>
</TR>

<TR>
<TD>Type</TD>
<TD>Содержит тип поля. Возможные значения - см. описание свойства "Type" объекта "Parameter".</TD>
</TR>

<TR>
<TD>Precision</TD>
<TD>Содержит степень точности для числовых значений поля (максимальное количество цифр).</TD>
</TR>

<TR>
<TD>NumericScale</TD>
<TD>Содержит масштаб числовых значений поля (количество десятичных знаков справа от запятой).</TD>
</TR>

<TR>
<TD>Properties</TD>
<TD>Содержит коллекцию динамических свойств объекта (объектов Property). Подробнее - см. раздел "Динамические
свойства объектов".</TD>
</TR>

</TABLE>
<br>
</p>

<p class="paragraph">
Пример "независимого" использования объекта Recordset:
<br><br>
<span style="color:navy; font-weight:bold;">
<pre>
Set objRecordset = CreateObject("ADODB.Recordset")
ServerName = "(local)" 'имя или IP-адрес сервера
DSN = "master" 'имя базы данных
UID = "sa" 'логин пользователя SQL-сервера
PWD = "111" 'пароль пользователя SQL-сервера
ConnectString = "Provider=SQLOLEDB;" & _
                "Data Source=" & ServerName & _
                ";Initial Catalog=" & DSN & _
                ";UID=" & UID & ";PWD=" & PWD
objRecordset.ActiveConnection = ConnectString
objRecordset.Source = "SELECT name, filename FROM sysdatabases"
objRecordset.Open
While Not objRecordset.EOF
    strRes = vbNullString
    For i=0 To objRecordset.Fields.Count-1
        strRes = strRes & CStr(objRecordset.Fields(i).Value) & vbTab
    Next
    WScript.Echo Trim(strRes)
    objRecordset.MoveNext
Wend
objRecordset.Close
Set objRecordset = Nothing
</pre>
</span>
</p>

<p class="paragraph">
Сохранение данных Recordset в формате XML:
<br><br>
<span style="color:navy; font-weight:bold;">
<pre>
Set objRecordset = CreateObject("ADODB.Recordset")
ServerName = "(local)" 'имя или IP-адрес сервера
DSN = "master" 'имя базы данных
UID = "sa" 'логин пользователя SQL-сервера
PWD = "111" 'пароль пользователя SQL-сервера
ConnectString = "Provider=SQLOLEDB;" & _
                "Data Source=" & ServerName & _
                ";Initial Catalog=" & DSN & _
                ";UID=" & UID & ";PWD=" & PWD
objRecordset.Open "SELECT name, filename FROM sysdatabases", ConnectString
objRecordset.Save "C:\test.xml", 1
objRecordset.Close
Set objRecordset = Nothing
</pre>
</span>
</p>

<p style="text-align:right">
<small>Людоговский Александр</small>
</p>

<p><a href="index.html">Перейти на главную страничку сайта (список статей, файлы для скачивания)</a></p>

<p><small>&copy; 2007 <A HREF='http://www.script-coding.com/'>http://www.script-coding.com</A> При любом использовании материалов сайта обязательна <b>ссылка</b> на него как на источник информации, а также сохранение <b>целостности</b> и <b>авторства</b> материалов.</small>



</body>
</html>